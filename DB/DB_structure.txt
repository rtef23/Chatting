drop table member_meta;
drop table chat_log;
drop table friend_list;
drop table friend_request;
drop table room_invite;
drop table room_joined;
drop table chat_room;
drop table member;

create table member (
	id char(30) not null unique,
	nickname varchar(40) not null, 
	password char(30) not null,
	name char(20) not null,
	primary key(id)
);

create table friend_list(
	fid1 char(30),
	fid2 char(30),
	foreign key(fid1) references member(id) on delete cascade on update cascade,
	foreign key(fid2) references member(id) on delete cascade on update cascade,
	primary key(fid1, fid2)
);

create table friend_request(
	from_id char(30),
	to_id char(30),
	request_date datetime not null,
	foreign key(from_id) references member(id) on delete cascade on update cascade,
	foreign key(to_id) references member(id) on delete cascade on update cascade,
	primary key(from_id, to_id)
);

create table member_meta(
	user_id char(30) not null,
	last_login datetime default null,
	create_date datetime not null,
	foreign key(user_id) references member(id) on delete cascade on update cascade
);

create table chat_room(
	room_id char(64) not null,
	room_title char(60),
	primary key(room_id)
);

create table room_joined(
	room_id char(64) not null,
	user_id char(30) not null,
	primary key(room_id, user_id),
	foreign key(user_id) references member(id) on delete cascade on update cascade,
	foreign key(room_id) references chat_room(room_id) on delete cascade on update cascade
);

create table room_invite(
	room_id char(64) not null,
	from_id char(30),
	to_id char(30),
	foreign key(from_id) references member(id) on delete cascade on update cascade,
	foreign key(to_id) references member(id) on delete cascade on update cascade,
	foreign key(room_id) references chat_room(room_id) on delete cascade on update cascade,
	primary key(room_id, to_id)
);

create table chat_log(
	log_id int(255) AUTO_INCREMENT,
	user_id char(30) not null,
	room_id char(64) not null,
	time char(10) not null,
	content char(255),
	foreign key(user_id) references member(id) on delete cascade on update cascade,
	foreign key(room_id) references chat_room(room_id) on delete cascade on update cascade,
	primary key(log_id)
);